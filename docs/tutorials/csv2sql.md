# Import a CSV file to CockroachDB using UPSERT

In this tutorial we will read a CSV and map the rows to UPSERT statements.

Assume the following delimited flat file `users-data.csv` containing user records (last `comment` column being in JSON):

    id;city;first_name;last_name;full_name;fav_color;profile
    fc2c115f-f691-484b-b42b-370dd4d63f21;Manokwari;Roland;Brennan; ;green;{"users":[{"email":"drew.simon@example.com","firstName":"Jaime","lastName":"McDonald","telephone":"(143) 597-6624","userName":"sabrina","addresses":[{"state":"American Samoa","stateCode":"NE","city":"Leixlip","country":"Norfolk Island","zipCode":"86200"},{"state":"North Carolina","stateCode":"KY","city":"Gaalkacyo","country":"United States","zipCode":"80084"}]},{"email":"drew.simon@example.com","firstName":"Jaime","lastName":"McDonald","telephone":"(143) 597-6624","userName":"sabrina","addresses":[{"state":"American Samoa","stateCode":"NE","city":"Leixlip","country":"Norfolk Island","zipCode":"86200"},{"state":"North Carolina","stateCode":"KY","city":"Gaalkacyo","country":"United States","zipCode":"80084"}]},{"email":"ola.cain@example.com","firstName":"Malinda","lastName":"Levine","telephone":"(610) 240-4330","userName":"lorie","addresses":[{"state":"Alaska","stateCode":"IN","city":"Ikoma","country":"Congo - Kinshasa","zipCode":"57991"},{"state":"Wyoming","stateCode":"MI","city":"Zumpango del Rio","country":"Isle of Man","zipCode":"53500"}]},{"email":"ola.cain@example.com","firstName":"Malinda","lastName":"Levine","telephone":"(610) 240-4330","userName":"lorie","addresses":[{"state":"Alaska","stateCode":"IN","city":"Ikoma","country":"Congo - Kinshasa","zipCode":"57991"},{"state":"Wyoming","stateCode":"MI","city":"Zumpango del Rio","country":"Isle of Man","zipCode":"53500"}]},{"email":"merle.curry@example.com","firstName":"Russel","lastName":"Rojas","telephone":"(203) 583-5321","userName":"lazaro","addresses":[{"state":"Utah","stateCode":"MD","city":"Shenango","country":"United States","zipCode":"63728"},{"state":"Wyoming","stateCode":"AL","city":"Sofiivka","country":"Hong Kong SAR China","zipCode":"42090"}]},{"email":"merle.curry@example.com","firstName":"Russel","lastName":"Rojas","telephone":"(203) 583-5321","userName":"lazaro","addresses":[{"state":"Utah","stateCode":"MD","city":"Shenango","country":"United States","zipCode":"63728"},{"state":"Wyoming","stateCode":"AL","city":"Sofiivka","country":"Hong Kong SAR China","zipCode":"42090"}]},{"email":"kayla.barnes@example.com","firstName":"Andy","lastName":"Hooper","telephone":"(169) 367-4876","userName":"forrest","addresses":[{"state":"Nebraska","stateCode":"HI","city":"Songo","country":"Brazil","zipCode":"66497"},{"state":"Alabama","stateCode":"MA","city":"Beasain","country":"Sweden","zipCode":"26163"}]},{"email":"kayla.barnes@example.com","firstName":"Andy","lastName":"Hooper","telephone":"(169) 367-4876","userName":"forrest","addresses":[{"state":"Nebraska","stateCode":"HI","city":"Songo","country":"Brazil","zipCode":"66497"},{"state":"Alabama","stateCode":"MA","city":"Beasain","country":"Sweden","zipCode":"26163"}]},{"email":"sharon.vincent@example.com","firstName":"Jim","lastName":"Banks","telephone":"(313) 468-9884","userName":"javier","addresses":[{"state":"Alaska","stateCode":"GU","city":"Stillwater","country":"Uganda","zipCode":"21291"},{"state":"South Dakota","stateCode":"ID","city":"Brumadinho","country":"Portugal","zipCode":"67341"}]},{"email":"sharon.vincent@example.com","firstName":"Jim","lastName":"Banks","telephone":"(313) 468-9884","userName":"javier","addresses":[{"state":"Alaska","stateCode":"GU","city":"Stillwater","country":"Uganda","zipCode":"21291"},{"state":"South Dakota","stateCode":"ID","city":"Brumadinho","country":"Portugal","zipCode":"67341"}]}]}
    abff6b0b-4fef-4d09-8607-67e618d6e13c;Coulogne;Avery;Reynolds; ;red;{"users":[{"email":"pasquale.gilbert@example.com","firstName":"Buford","lastName":"Martin","telephone":"(589) 760-1155","userName":"vito","addresses":[{"state":"Indiana","stateCode":"UT","city":"Bodupal","country":"Sweden","zipCode":"91670"},{"state":"Puerto Rico","stateCode":"OK","city":"Amite City","country":"Angola","zipCode":"61730"}]},{"email":"pasquale.gilbert@example.com","firstName":"Buford","lastName":"Martin","telephone":"(589) 760-1155","userName":"vito","addresses":[{"state":"Indiana","stateCode":"UT","city":"Bodupal","country":"Sweden","zipCode":"91670"},{"state":"Puerto Rico","stateCode":"OK","city":"Amite City","country":"Angola","zipCode":"61730"}]},{"email":"queen.patterson@example.com","firstName":"Eric","lastName":"English","telephone":"(681) 230-5608","userName":"carla","addresses":[{"state":"Connecticut","stateCode":"DC","city":"Povegliano Veronese","country":"Central African Republic","zipCode":"76732"},{"state":"New York","stateCode":"RI","city":"Orange Park","country":"Senegal","zipCode":"85043"}]},{"email":"queen.patterson@example.com","firstName":"Eric","lastName":"English","telephone":"(681) 230-5608","userName":"carla","addresses":[{"state":"Connecticut","stateCode":"DC","city":"Povegliano Veronese","country":"Central African Republic","zipCode":"76732"},{"state":"New York","stateCode":"RI","city":"Orange Park","country":"Senegal","zipCode":"85043"}]},{"email":"efren.riddle@example.com","firstName":"Nellie","lastName":"Conrad","telephone":"(640) 127-2551","userName":"lon","addresses":[{"state":"Oklahoma","stateCode":"CT","city":"Aibak","country":"United Kingdom","zipCode":"15760"},{"state":"New Mexico","stateCode":"SD","city":"Malaya Purga","country":"Eritrea","zipCode":"27180"}]},{"email":"efren.riddle@example.com","firstName":"Nellie","lastName":"Conrad","telephone":"(640) 127-2551","userName":"lon","addresses":[{"state":"Oklahoma","stateCode":"CT","city":"Aibak","country":"United Kingdom","zipCode":"15760"},{"state":"New Mexico","stateCode":"SD","city":"Malaya Purga","country":"Eritrea","zipCode":"27180"}]},{"email":"noel.patton@example.com","firstName":"Lela","lastName":"Newton","telephone":"(823) 621-8547","userName":"rosanne","addresses":[{"state":"South Carolina","stateCode":"MP","city":"Didymoteicho","country":"Bosnia & Herzegovina","zipCode":"79357"},{"state":"Texas","stateCode":"LA","city":"Thiais","country":"China","zipCode":"16368"}]},{"email":"noel.patton@example.com","firstName":"Lela","lastName":"Newton","telephone":"(823) 621-8547","userName":"rosanne","addresses":[{"state":"South Carolina","stateCode":"MP","city":"Didymoteicho","country":"Bosnia & Herzegovina","zipCode":"79357"},{"state":"Texas","stateCode":"LA","city":"Thiais","country":"China","zipCode":"16368"}]},{"email":"herminia.simon@example.com","firstName":"Heath","lastName":"Huffman","telephone":"(760) 366-7993","userName":"federico","addresses":[{"state":"Puerto Rico","stateCode":"NE","city":"Montville","country":"Tanzania","zipCode":"64929"},{"state":"American Samoa","stateCode":"OH","city":"Mjolby","country":"New Zealand","zipCode":"73567"}]},{"email":"herminia.simon@example.com","firstName":"Heath","lastName":"Huffman","telephone":"(760) 366-7993","userName":"federico","addresses":[{"state":"Puerto Rico","stateCode":"NE","city":"Montville","country":"Tanzania","zipCode":"64929"},{"state":"American Samoa","stateCode":"OH","city":"Mjolby","country":"New Zealand","zipCode":"73567"}]}]}
    97298235-b14f-4000-bdc5-97c3f18323fc;Archidona;Laura;Warner; ;green;{"users":[{"email":"esther.wise@example.com","firstName":"Adriana","lastName":"Reyes","telephone":"(914) 290-7438","userName":"tammy","addresses":[{"state":"Montana","stateCode":"VI","city":"Poggio a Caiano","country":"China","zipCode":"34859"},{"state":"Indiana","stateCode":"MN","city":"Soure","country":"Réunion","zipCode":"27978"}]},{"email":"esther.wise@example.com","firstName":"Adriana","lastName":"Reyes","telephone":"(914) 290-7438","userName":"tammy","addresses":[{"state":"Montana","stateCode":"VI","city":"Poggio a Caiano","country":"China","zipCode":"34859"},{"state":"Indiana","stateCode":"MN","city":"Soure","country":"Réunion","zipCode":"27978"}]},{"email":"devin.todd@example.com","firstName":"Vicki","lastName":"Wells","telephone":"(873) 191-4588","userName":"lilly","addresses":[{"state":"District of Columbia","stateCode":"ND","city":"Crepy-en-Valois","country":"Somalia","zipCode":"34963"},{"state":"Kentucky","stateCode":"AS","city":"Tepelene","country":"Brazil","zipCode":"58172"}]},{"email":"devin.todd@example.com","firstName":"Vicki","lastName":"Wells","telephone":"(873) 191-4588","userName":"lilly","addresses":[{"state":"District of Columbia","stateCode":"ND","city":"Crepy-en-Valois","country":"Somalia","zipCode":"34963"},{"state":"Kentucky","stateCode":"AS","city":"Tepelene","country":"Brazil","zipCode":"58172"}]},{"email":"ester.moses@example.com","firstName":"Tabatha","lastName":"Sullivan","telephone":"(283) 665-5649","userName":"gerardo","addresses":[{"state":"Wisconsin","stateCode":"ME","city":"Ellenville","country":"Montenegro","zipCode":"05010"},{"state":"Virgin Islands","stateCode":"VT","city":"Oldham","country":"Uzbekistan","zipCode":"99301"}]},{"email":"ester.moses@example.com","firstName":"Tabatha","lastName":"Sullivan","telephone":"(283) 665-5649","userName":"gerardo","addresses":[{"state":"Wisconsin","stateCode":"ME","city":"Ellenville","country":"Montenegro","zipCode":"05010"},{"state":"Virgin Islands","stateCode":"VT","city":"Oldham","country":"Uzbekistan","zipCode":"99301"}]},{"email":"preston.copeland@example.com","firstName":"Ladonna","lastName":"Rich","telephone":"(527) 639-8065","userName":"hilary","addresses":[{"state":"Arkansas","stateCode":"KY","city":"Elektrenai","country":"India","zipCode":"74805"},{"state":"American Samoa","stateCode":"ND","city":"Cheb","country":"Spain","zipCode":"12832"}]},{"email":"preston.copeland@example.com","firstName":"Ladonna","lastName":"Rich","telephone":"(527) 639-8065","userName":"hilary","addresses":[{"state":"Arkansas","stateCode":"KY","city":"Elektrenai","country":"India","zipCode":"74805"},{"state":"American Samoa","stateCode":"ND","city":"Cheb","country":"Spain","zipCode":"12832"}]},{"email":"reyna.shelton@example.com","firstName":"Tamera","lastName":"Huffman","telephone":"(473) 839-6758","userName":"pierre","addresses":[{"state":"New Hampshire","stateCode":"WI","city":"Milton","country":"Canada","zipCode":"47639"},{"state":"Iowa","stateCode":"ME","city":"Thornton","country":"Niger","zipCode":"12237"}]},{"email":"reyna.shelton@example.com","firstName":"Tamera","lastName":"Huffman","telephone":"(473) 839-6758","userName":"pierre","addresses":[{"state":"New Hampshire","stateCode":"WI","city":"Milton","country":"Canada","zipCode":"47639"},{"state":"Iowa","stateCode":"ME","city":"Thornton","country":"Niger","zipCode":"12237"}]}]}
    cb68c3b7-1c76-4788-ab1b-93893186f4bb;Paignton;Liz;Hood; ;red;{"users":[{"email":"joann.gonzalez@example.com","firstName":"Angel","lastName":"Munoz","telephone":"(638) 571-9713","userName":"denis","addresses":[{"state":"Palau","stateCode":"CO","city":"Dobsina","country":"Jersey","zipCode":"93525"},{"state":"Rhode Island","stateCode":"VA","city":"Venturosa","country":"Turkey","zipCode":"91081"}]},{"email":"joann.gonzalez@example.com","firstName":"Angel","lastName":"Munoz","telephone":"(638) 571-9713","userName":"denis","addresses":[{"state":"Palau","stateCode":"CO","city":"Dobsina","country":"Jersey","zipCode":"93525"},{"state":"Rhode Island","stateCode":"VA","city":"Venturosa","country":"Turkey","zipCode":"91081"}]},{"email":"edward.morse@example.com","firstName":"Camille","lastName":"Alvarado","telephone":"(504) 409-9448","userName":"colby","addresses":[{"state":"Guam Gu","stateCode":"KY","city":"Pocking","country":"Tanzania","zipCode":"47779"},{"state":"Kentucky","stateCode":"WY","city":"Toudouni","country":"Eritrea","zipCode":"01405"}]},{"email":"edward.morse@example.com","firstName":"Camille","lastName":"Alvarado","telephone":"(504) 409-9448","userName":"colby","addresses":[{"state":"Guam Gu","stateCode":"KY","city":"Pocking","country":"Tanzania","zipCode":"47779"},{"state":"Kentucky","stateCode":"WY","city":"Toudouni","country":"Eritrea","zipCode":"01405"}]},{"email":"desmond.cardenas@example.com","firstName":"Cherie","lastName":"Flowers","telephone":"(338) 543-3060","userName":"ed","addresses":[{"state":"Iowa","stateCode":"NJ","city":"Ronchi dei Legionari","country":"Cameroon","zipCode":"19742"},{"state":"West Virginia","stateCode":"KS","city":"Pecan Grove","country":"Guinea-Bissau","zipCode":"82511"}]},{"email":"desmond.cardenas@example.com","firstName":"Cherie","lastName":"Flowers","telephone":"(338) 543-3060","userName":"ed","addresses":[{"state":"Iowa","stateCode":"NJ","city":"Ronchi dei Legionari","country":"Cameroon","zipCode":"19742"},{"state":"West Virginia","stateCode":"KS","city":"Pecan Grove","country":"Guinea-Bissau","zipCode":"82511"}]},{"email":"efrain.ruiz@example.com","firstName":"Isabel","lastName":"Ewing","telephone":"(685) 817-1390","userName":"landon","addresses":[{"state":"Alabama","stateCode":"PR","city":"Valletta","country":"Central African Republic","zipCode":"83543"},{"state":"Delaware","stateCode":"OK","city":"Itaberaba","country":"Finland","zipCode":"31524"}]},{"email":"efrain.ruiz@example.com","firstName":"Isabel","lastName":"Ewing","telephone":"(685) 817-1390","userName":"landon","addresses":[{"state":"Alabama","stateCode":"PR","city":"Valletta","country":"Central African Republic","zipCode":"83543"},{"state":"Delaware","stateCode":"OK","city":"Itaberaba","country":"Finland","zipCode":"31524"}]},{"email":"lorna.spears@example.com","firstName":"Hollis","lastName":"Franklin","telephone":"(887) 795-5180","userName":"noel","addresses":[{"state":"Ohio","stateCode":"AR","city":"Lydney","country":"Ireland","zipCode":"71544"},{"state":"Delaware","stateCode":"SC","city":"Carcassonne","country":"Kenya","zipCode":"01121"}]},{"email":"lorna.spears@example.com","firstName":"Hollis","lastName":"Franklin","telephone":"(887) 795-5180","userName":"noel","addresses":[{"state":"Ohio","stateCode":"AR","city":"Lydney","country":"Ireland","zipCode":"71544"},{"state":"Delaware","stateCode":"SC","city":"Carcassonne","country":"Kenya","zipCode":"01121"}]}]}
    dc2038ae-9eee-49e7-83c9-96d853e9c789;Yarumal;Reyna;Bradshaw; ;green;{"users":[{"email":"rosalinda.mayer@example.com","firstName":"Corrine","lastName":"Lewis","telephone":"(242) 851-3355","userName":"arline","addresses":[{"state":"Guam Gu","stateCode":"NM","city":"Stone Mountain","country":"Cambodia","zipCode":"46312"},{"state":"Arkansas","stateCode":"GU","city":"Ra's al Khaymah","country":"Caribbean Netherlands","zipCode":"03874"}]},{"email":"rosalinda.mayer@example.com","firstName":"Corrine","lastName":"Lewis","telephone":"(242) 851-3355","userName":"arline","addresses":[{"state":"Guam Gu","stateCode":"NM","city":"Stone Mountain","country":"Cambodia","zipCode":"46312"},{"state":"Arkansas","stateCode":"GU","city":"Ra's al Khaymah","country":"Caribbean Netherlands","zipCode":"03874"}]},{"email":"michael.hale@example.com","firstName":"Gerard","lastName":"Gallagher","telephone":"(205) 182-1083","userName":"vilma","addresses":[{"state":"New Mexico","stateCode":"NM","city":"Kitimat","country":"United States","zipCode":"81809"},{"state":"Federated States of Micronesia","stateCode":"RI","city":"San Pedro","country":"Liberia","zipCode":"23008"}]},{"email":"michael.hale@example.com","firstName":"Gerard","lastName":"Gallagher","telephone":"(205) 182-1083","userName":"vilma","addresses":[{"state":"New Mexico","stateCode":"NM","city":"Kitimat","country":"United States","zipCode":"81809"},{"state":"Federated States of Micronesia","stateCode":"RI","city":"San Pedro","country":"Liberia","zipCode":"23008"}]},{"email":"aurora.robles@example.com","firstName":"Andy","lastName":"Beach","telephone":"(711) 365-5257","userName":"essie","addresses":[{"state":"Michigan","stateCode":"OK","city":"North Platte","country":"South Sudan","zipCode":"92793"},{"state":"South Dakota","stateCode":"AL","city":"Veldhoven","country":"South Africa","zipCode":"18820"}]},{"email":"aurora.robles@example.com","firstName":"Andy","lastName":"Beach","telephone":"(711) 365-5257","userName":"essie","addresses":[{"state":"Michigan","stateCode":"OK","city":"North Platte","country":"South Sudan","zipCode":"92793"},{"state":"South Dakota","stateCode":"AL","city":"Veldhoven","country":"South Africa","zipCode":"18820"}]},{"email":"elias.rollins@example.com","firstName":"Melvin","lastName":"Banks","telephone":"(174) 989-6067","userName":"angelo","addresses":[{"state":"Montana","stateCode":"DE","city":"Cliftonville","country":"France","zipCode":"93294"},{"state":"Nebraska","stateCode":"NV","city":"Arezzo","country":"Kenya","zipCode":"98482"}]},{"email":"elias.rollins@example.com","firstName":"Melvin","lastName":"Banks","telephone":"(174) 989-6067","userName":"angelo","addresses":[{"state":"Montana","stateCode":"DE","city":"Cliftonville","country":"France","zipCode":"93294"},{"state":"Nebraska","stateCode":"NV","city":"Arezzo","country":"Kenya","zipCode":"98482"}]},{"email":"pam.goodman@example.com","firstName":"Harris","lastName":"Singleton","telephone":"(359) 673-0526","userName":"cecilia","addresses":[{"state":"Wisconsin","stateCode":"AK","city":"Francisco Alves","country":"Cameroon","zipCode":"07873"},{"state":"Palau","stateCode":"OR","city":"Pulivendla","country":"United Kingdom","zipCode":"69316"}]},{"email":"pam.goodman@example.com","firstName":"Harris","lastName":"Singleton","telephone":"(359) 673-0526","userName":"cecilia","addresses":[{"state":"Wisconsin","stateCode":"AK","city":"Francisco Alves","country":"Cameroon","zipCode":"07873"},{"state":"Palau","stateCode":"OR","city":"Pulivendla","country":"United Kingdom","zipCode":"69316"}]}]}
    6656d0c3-8654-4a19-9c4f-9263ac6c50ac;Fernie;Jeannie;Alvarado; ;red;{"users":[{"email":"tommie.woodward@example.com","firstName":"Maria","lastName":"Horn","telephone":"(117) 285-3817","userName":"kelley","addresses":[{"state":"Alabama","stateCode":"VT","city":"Nazca","country":"Georgia","zipCode":"74132"},{"state":"Guam Gu","stateCode":"WI","city":"Photharam","country":"Bolivia","zipCode":"41751"}]},{"email":"tommie.woodward@example.com","firstName":"Maria","lastName":"Horn","telephone":"(117) 285-3817","userName":"kelley","addresses":[{"state":"Alabama","stateCode":"VT","city":"Nazca","country":"Georgia","zipCode":"74132"},{"state":"Guam Gu","stateCode":"WI","city":"Photharam","country":"Bolivia","zipCode":"41751"}]},{"email":"luz.mosley@example.com","firstName":"Polly","lastName":"Villarreal","telephone":"(942) 796-6441","userName":"vilma","addresses":[{"state":"Michigan","stateCode":"KS","city":"Freudenberg","country":"Zimbabwe","zipCode":"67418"},{"state":"New Jersey","stateCode":"GU","city":"Port Sudan","country":"Switzerland","zipCode":"21084"}]},{"email":"luz.mosley@example.com","firstName":"Polly","lastName":"Villarreal","telephone":"(942) 796-6441","userName":"vilma","addresses":[{"state":"Michigan","stateCode":"KS","city":"Freudenberg","country":"Zimbabwe","zipCode":"67418"},{"state":"New Jersey","stateCode":"GU","city":"Port Sudan","country":"Switzerland","zipCode":"21084"}]},{"email":"genaro.woods@example.com","firstName":"Eugene","lastName":"Graves","telephone":"(193) 902-3328","userName":"carmela","addresses":[{"state":"Pennsylvania","stateCode":"VA","city":"Chateaudun","country":"Bosnia & Herzegovina","zipCode":"37126"},{"state":"Puerto Rico","stateCode":"WA","city":"Mexicaltzingo","country":"China","zipCode":"98746"}]},{"email":"genaro.woods@example.com","firstName":"Eugene","lastName":"Graves","telephone":"(193) 902-3328","userName":"carmela","addresses":[{"state":"Pennsylvania","stateCode":"VA","city":"Chateaudun","country":"Bosnia & Herzegovina","zipCode":"37126"},{"state":"Puerto Rico","stateCode":"WA","city":"Mexicaltzingo","country":"China","zipCode":"98746"}]},{"email":"natalia.ramsey@example.com","firstName":"Lauri","lastName":"Hinton","telephone":"(584) 625-8148","userName":"lourdes","addresses":[{"state":"South Dakota","stateCode":"PR","city":"Golden Valley","country":"Cameroon","zipCode":"98619"},{"state":"Virginia","stateCode":"OH","city":"Malatya","country":"Belize","zipCode":"13042"}]},{"email":"natalia.ramsey@example.com","firstName":"Lauri","lastName":"Hinton","telephone":"(584) 625-8148","userName":"lourdes","addresses":[{"state":"South Dakota","stateCode":"PR","city":"Golden Valley","country":"Cameroon","zipCode":"98619"},{"state":"Virginia","stateCode":"OH","city":"Malatya","country":"Belize","zipCode":"13042"}]},{"email":"marci.lawrence@example.com","firstName":"Scott","lastName":"Forbes","telephone":"(928) 109-1235","userName":"beau","addresses":[{"state":"Maine","stateCode":"GA","city":"Uden","country":"Cameroon","zipCode":"57578"},{"state":"Maryland","stateCode":"SD","city":"Niederorschel","country":"Philippines","zipCode":"09568"}]},{"email":"marci.lawrence@example.com","firstName":"Scott","lastName":"Forbes","telephone":"(928) 109-1235","userName":"beau","addresses":[{"state":"Maine","stateCode":"GA","city":"Uden","country":"Cameroon","zipCode":"57578"},{"state":"Maryland","stateCode":"SD","city":"Niederorschel","country":"Philippines","zipCode":"09568"}]}]}
    84e5729b-7e91-49da-afcd-995ac22fe9e1;Santes;Wilda;Singleton; ;green;{"users":[{"email":"george.ingram@example.com","firstName":"Lillie","lastName":"Evans","telephone":"(281) 960-9489","userName":"kerri","addresses":[{"state":"New Mexico","stateCode":"WV","city":"Saint-Pathus","country":"Kiribati","zipCode":"49496"},{"state":"Maine","stateCode":"TX","city":"Xiangxiang","country":"Nigeria","zipCode":"91977"}]},{"email":"george.ingram@example.com","firstName":"Lillie","lastName":"Evans","telephone":"(281) 960-9489","userName":"kerri","addresses":[{"state":"New Mexico","stateCode":"WV","city":"Saint-Pathus","country":"Kiribati","zipCode":"49496"},{"state":"Maine","stateCode":"TX","city":"Xiangxiang","country":"Nigeria","zipCode":"91977"}]},{"email":"dino.ballard@example.com","firstName":"Josue","lastName":"Benson","telephone":"(112) 982-7105","userName":"rowena","addresses":[{"state":"Federated States of Micronesia","stateCode":"CO","city":"Cervaro","country":"Zambia","zipCode":"22391"},{"state":"Maine","stateCode":"CO","city":"Khasab","country":"Zimbabwe","zipCode":"44767"}]},{"email":"dino.ballard@example.com","firstName":"Josue","lastName":"Benson","telephone":"(112) 982-7105","userName":"rowena","addresses":[{"state":"Federated States of Micronesia","stateCode":"CO","city":"Cervaro","country":"Zambia","zipCode":"22391"},{"state":"Maine","stateCode":"CO","city":"Khasab","country":"Zimbabwe","zipCode":"44767"}]},{"email":"alvin.butler@example.com","firstName":"Marcel","lastName":"Bond","telephone":"(604) 203-5291","userName":"sadie","addresses":[{"state":"Florida","stateCode":"NC","city":"San Jose Tenango","country":"Central African Republic","zipCode":"73558"},{"state":"Wisconsin","stateCode":"TN","city":"Dayton","country":"Tanzania","zipCode":"38837"}]},{"email":"alvin.butler@example.com","firstName":"Marcel","lastName":"Bond","telephone":"(604) 203-5291","userName":"sadie","addresses":[{"state":"Florida","stateCode":"NC","city":"San Jose Tenango","country":"Central African Republic","zipCode":"73558"},{"state":"Wisconsin","stateCode":"TN","city":"Dayton","country":"Tanzania","zipCode":"38837"}]},{"email":"inez.mendez@example.com","firstName":"Alexandria","lastName":"Flores","telephone":"(512) 886-8166","userName":"christian","addresses":[{"state":"Washington","stateCode":"TN","city":"Sumner","country":"Cameroon","zipCode":"97348"},{"state":"Marshall Islands","stateCode":"OK","city":"Sound Beach","country":"Finland","zipCode":"14884"}]},{"email":"inez.mendez@example.com","firstName":"Alexandria","lastName":"Flores","telephone":"(512) 886-8166","userName":"christian","addresses":[{"state":"Washington","stateCode":"TN","city":"Sumner","country":"Cameroon","zipCode":"97348"},{"state":"Marshall Islands","stateCode":"OK","city":"Sound Beach","country":"Finland","zipCode":"14884"}]},{"email":"efren.brooks@example.com","firstName":"Nichole","lastName":"Estrada","telephone":"(372) 533-2717","userName":"jewel","addresses":[{"state":"Colorado","stateCode":"MD","city":"Hakone","country":"Palau","zipCode":"59185"},{"state":"Arkansas","stateCode":"MD","city":"Shrewsbury","country":"Latin America","zipCode":"82344"}]},{"email":"efren.brooks@example.com","firstName":"Nichole","lastName":"Estrada","telephone":"(372) 533-2717","userName":"jewel","addresses":[{"state":"Colorado","stateCode":"MD","city":"Hakone","country":"Palau","zipCode":"59185"},{"state":"Arkansas","stateCode":"MD","city":"Shrewsbury","country":"Latin America","zipCode":"82344"}]}]}
    06b60ece-6203-485d-aeb3-4cf452ebc6ae;Bouknadel;Wade;Casey; ;red;{"users":[{"email":"grace.meadows@example.com","firstName":"Keri","lastName":"Joseph","telephone":"(347) 233-5136","userName":"tanisha","addresses":[{"state":"Marshall Islands","stateCode":"SD","city":"Stryi","country":"Uzbekistan","zipCode":"57918"},{"state":"Wisconsin","stateCode":"RI","city":"Soultz-Haut-Rhin","country":"Macao SAR China","zipCode":"21798"}]},{"email":"grace.meadows@example.com","firstName":"Keri","lastName":"Joseph","telephone":"(347) 233-5136","userName":"tanisha","addresses":[{"state":"Marshall Islands","stateCode":"SD","city":"Stryi","country":"Uzbekistan","zipCode":"57918"},{"state":"Wisconsin","stateCode":"RI","city":"Soultz-Haut-Rhin","country":"Macao SAR China","zipCode":"21798"}]},{"email":"jaclyn.cohen@example.com","firstName":"Deirdre","lastName":"Schmidt","telephone":"(553) 187-3066","userName":"jannie","addresses":[{"state":"Puerto Rico","stateCode":"IN","city":"Tagum","country":"Sierra Leone","zipCode":"53427"},{"state":"Iowa","stateCode":"WY","city":"Canyon","country":"Thailand","zipCode":"01227"}]},{"email":"jaclyn.cohen@example.com","firstName":"Deirdre","lastName":"Schmidt","telephone":"(553) 187-3066","userName":"jannie","addresses":[{"state":"Puerto Rico","stateCode":"IN","city":"Tagum","country":"Sierra Leone","zipCode":"53427"},{"state":"Iowa","stateCode":"WY","city":"Canyon","country":"Thailand","zipCode":"01227"}]},{"email":"esperanza.fitzpatrick@example.com","firstName":"Dudley","lastName":"Waller","telephone":"(350) 962-3029","userName":"maurice","addresses":[{"state":"Kansas","stateCode":"MN","city":"Richland","country":"Israel","zipCode":"36888"},{"state":"North Carolina","stateCode":"OH","city":"Lappersdorf","country":"Switzerland","zipCode":"00618"}]},{"email":"esperanza.fitzpatrick@example.com","firstName":"Dudley","lastName":"Waller","telephone":"(350) 962-3029","userName":"maurice","addresses":[{"state":"Kansas","stateCode":"MN","city":"Richland","country":"Israel","zipCode":"36888"},{"state":"North Carolina","stateCode":"OH","city":"Lappersdorf","country":"Switzerland","zipCode":"00618"}]},{"email":"thad.rollins@example.com","firstName":"Randy","lastName":"Miranda","telephone":"(783) 347-9672","userName":"kristen","addresses":[{"state":"New York","stateCode":"OR","city":"Merces","country":"Canada","zipCode":"10910"},{"state":"Florida","stateCode":"CT","city":"Saint-Marcel-les-Valence","country":"Peru","zipCode":"34322"}]},{"email":"thad.rollins@example.com","firstName":"Randy","lastName":"Miranda","telephone":"(783) 347-9672","userName":"kristen","addresses":[{"state":"New York","stateCode":"OR","city":"Merces","country":"Canada","zipCode":"10910"},{"state":"Florida","stateCode":"CT","city":"Saint-Marcel-les-Valence","country":"Peru","zipCode":"34322"}]},{"email":"jamel.hopkins@example.com","firstName":"Rex","lastName":"Anthony","telephone":"(862) 302-0228","userName":"augusta","addresses":[{"state":"Alabama","stateCode":"NC","city":"Alabel","country":"Brazil","zipCode":"10935"},{"state":"South Dakota","stateCode":"ID","city":"Santa Catarina","country":"Afghanistan","zipCode":"57509"}]},{"email":"jamel.hopkins@example.com","firstName":"Rex","lastName":"Anthony","telephone":"(862) 302-0228","userName":"augusta","addresses":[{"state":"Alabama","stateCode":"NC","city":"Alabel","country":"Brazil","zipCode":"10935"},{"state":"South Dakota","stateCode":"ID","city":"Santa Catarina","country":"Afghanistan","zipCode":"57509"}]}]}
    77bfa1f2-7c37-48d4-ab29-2e2c948b1244;Sao Gabriel da Cachoeira;Simon;Dale; ;green;{"users":[{"email":"jaclyn.frederick@example.com","firstName":"Maxwell","lastName":"Price","telephone":"(348) 351-3020","userName":"katelyn","addresses":[{"state":"Wisconsin","stateCode":"OH","city":"Susel","country":"Argentina","zipCode":"42552"},{"state":"Louisiana","stateCode":"IA","city":"Nizhniy Tagil","country":"Bolivia","zipCode":"39798"}]},{"email":"jaclyn.frederick@example.com","firstName":"Maxwell","lastName":"Price","telephone":"(348) 351-3020","userName":"katelyn","addresses":[{"state":"Wisconsin","stateCode":"OH","city":"Susel","country":"Argentina","zipCode":"42552"},{"state":"Louisiana","stateCode":"IA","city":"Nizhniy Tagil","country":"Bolivia","zipCode":"39798"}]},{"email":"alberto.bishop@example.com","firstName":"Francisca","lastName":"Joseph","telephone":"(706) 328-6697","userName":"daryl","addresses":[{"state":"Federated States of Micronesia","stateCode":"KS","city":"Edgewood","country":"India","zipCode":"07493"},{"state":"Connecticut","stateCode":"MH","city":"Montgomery","country":"Côte d’Ivoire","zipCode":"78663"}]},{"email":"alberto.bishop@example.com","firstName":"Francisca","lastName":"Joseph","telephone":"(706) 328-6697","userName":"daryl","addresses":[{"state":"Federated States of Micronesia","stateCode":"KS","city":"Edgewood","country":"India","zipCode":"07493"},{"state":"Connecticut","stateCode":"MH","city":"Montgomery","country":"Côte d’Ivoire","zipCode":"78663"}]},{"email":"susana.townsend@example.com","firstName":"Kendrick","lastName":"Sampson","telephone":"(548) 728-4558","userName":"emerson","addresses":[{"state":"Idaho","stateCode":"CA","city":"San Casciano in Val di Pesa","country":"Central African Republic","zipCode":"46928"},{"state":"Puerto Rico","stateCode":"ND","city":"Middelharnis","country":"Montenegro","zipCode":"91348"}]},{"email":"susana.townsend@example.com","firstName":"Kendrick","lastName":"Sampson","telephone":"(548) 728-4558","userName":"emerson","addresses":[{"state":"Idaho","stateCode":"CA","city":"San Casciano in Val di Pesa","country":"Central African Republic","zipCode":"46928"},{"state":"Puerto Rico","stateCode":"ND","city":"Middelharnis","country":"Montenegro","zipCode":"91348"}]},{"email":"glenda.hammond@example.com","firstName":"Valentin","lastName":"Conrad","telephone":"(233) 481-4366","userName":"pauline","addresses":[{"state":"American Samoa","stateCode":"KS","city":"Hagen im Bremischen","country":"Lithuania","zipCode":"44791"},{"state":"Palau","stateCode":"AK","city":"Rogers","country":"Gibraltar","zipCode":"75728"}]},{"email":"glenda.hammond@example.com","firstName":"Valentin","lastName":"Conrad","telephone":"(233) 481-4366","userName":"pauline","addresses":[{"state":"American Samoa","stateCode":"KS","city":"Hagen im Bremischen","country":"Lithuania","zipCode":"44791"},{"state":"Palau","stateCode":"AK","city":"Rogers","country":"Gibraltar","zipCode":"75728"}]},{"email":"cathryn.shields@example.com","firstName":"Efrain","lastName":"Shannon","telephone":"(509) 833-7983","userName":"rudy","addresses":[{"state":"Guam Gu","stateCode":"RI","city":"Limana","country":"United States","zipCode":"45297"},{"state":"Delaware","stateCode":"CA","city":"Lyaskovets","country":"Finland","zipCode":"70385"}]},{"email":"cathryn.shields@example.com","firstName":"Efrain","lastName":"Shannon","telephone":"(509) 833-7983","userName":"rudy","addresses":[{"state":"Guam Gu","stateCode":"RI","city":"Limana","country":"United States","zipCode":"45297"},{"state":"Delaware","stateCode":"CA","city":"Lyaskovets","country":"Finland","zipCode":"70385"}]}]}

Next, we define a `users-schema.json` schema for the CSV:

    {
      "fields": [
        {
          "name": "id"
        },
        {
          "name": "city"
        },
        {
          "name": "first_name"
        },
        {
          "name": "last_name"
        },
        {
          "name": "full_name",
          "ignored": true
        },
        {
          "name": "fav_color"
        },
        {
          "name": "profile"
        }
      ],
      "tokenizer": {
        "type": "delimited",
        "delimiter": ";",
        "quoteCharacter": "\""
      }
    }

Notice that `full_name` is ignored since it's a computed column.

Then, we create a table in CockroachDB:

    CREATE TABLE IF NOT EXISTS users
    (
        id         UUID   NOT NULL DEFAULT gen_random_uuid(),
        city       STRING NOT NULL,
        first_name STRING NOT NULL,
        last_name  STRING NOT NULL,
        full_name  STRING AS (CONCAT(first_name, ' ', last_name)) STORED,
        fav_color  STRING NULL     default 'n/a',
        profile    JSONB  NULL,
    
        PRIMARY KEY (city ASC, id ASC)
    );


Now we are ready to run the job. Let's begin by first getting a form template that describes the job:

    curl -X GET http://localhost:8090/flat2sql/form > users-job.json                                           

Edit the `users-job.json` form and fill in the details:

     {
       "source": "nodelocal:users-data.csv",
       "schema": "nodelocal:users-schema.json",
       "chunkSize": 256,
       "linesToSkip": 0,
       "targetUrl": "jdbc:postgresql://localhost:26257/tpcc_copy",
       "targetUsername": "root",
       "targetPassword": "",
       "insertQuery": "UPSERT INTO users(id, city, first_name, last_name, fav_color, profile) values (?,?,?,?,?,?)"
    }

Now POST the form back using:

    curl -d "@users-job.json" -H "Content-Type:application/json" -X POST http://localhost:8090/flat2sql

If you get a 201 status code the job was submitted successfully for processing. To inspect the job status
and potential errors, follow the link provided in the response, for example:

    curl -X GET http://localhost:8090/jobs/execution/future/6fd3bcd8-da30-4f3e-bb29-976265e6eccd

Look for COMPLETED status:

    "batchStatus" : "COMPLETED",
    "exitStatus" : {
        "exitCode" : "COMPLETED",
        "exitDescription" : "",
        "running" : false
    }

Finally, verify that the rows were inserted in CockroachDB:

    select count(1) from users;

    select id, jsonb_pretty(profile) from users limit 1;